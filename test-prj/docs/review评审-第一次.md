# Claude Code + Git Hooks 智能集成系统 - PRD 评审意见稿（v2.0）

> 评审日期：2025-09-06  
> 评审人：严苛 PM  
> 文档版本：基于 00-product-prd.md 与最新约束重新评估  
> 评审性质：**个人本地 CLI 工具定向评审**

---

## ✅ 本次评审前置约束（必须满足）

| 约束项 | 要求 | 原 PRD 是否满足 | 结论 |
| --- | --- | --- | --- |
| 部署形态 | **仅本地 CLI**，禁止云端服务 | ❌ 全文假设云端/企业部署 | **需重写** |
| 商业模式 | **0 商业化**，个人免费工具 | ❌ 大量篇幅计算 ROI、定价 | **需删除** |
| 模型选型 | **降级模型**，禁用 Opus | ❌ 默认 Claude-3-Opus | **需替换** |
| 交互界面 | **纯终端交互**，禁止 Web UI | ❌ 规划 Web 管理界面 | **需删除** |

---

## 🔍 一、愿景与定位再审

| 维度 | 原 PRD 表述 | 本地 CLI  reality | 严苛结论 |
| --- | --- | --- | --- |
| 产品使命 | “AI 成为每个开发者的智能助手” | 本地脚本=无生态、无协作 | 使命过度宏大，**降级**为 “本地 commit 前的代码守门员” |
| 核心价值 | 实时洞察、自动优化、质量保障 | 本地算力+轻量模型=弱洞察 | 砍掉“实时”“自动”字眼，改为 **轻量提示+可选修复** |
| 目标用户 | 企业团队、DevOps、CTO | 个人开发者，单仓库 | 删除所有“团队”“企业”用词，**仅保留个人** |

---

## 🧱 二、功能范围重划（CLI 专属）

### ❌ 整体剔除
1. **Web UI** → 全部删除  
2. **多用户/权限/SSO** → 删除  
3. **仪表板/报表/周报** → 删除  
4. **CI/CD 集成** → 删除（本地 git hook 不影响远端）  
5. **计费、License、SLA** → 删除  

### ✅ 保留但降级
| 原模块 | 本地 CLI 最小化版本 | 模型要求 | 性能预算 |
| --- | --- | --- | --- |
| 代码分析 | 仅 pre-commit 触发；单行 diff 扫描 | Haiku-3 / 本地 4-bit 量化 | <2s |
| 文档生成 | 仅生成/更新 **当前文件** 头部注释 | Haiku-3 | <1s |
| 自动修复 | **只读建议**，默认不落地；需 `-y` 才写入 | Haiku-3 | <2s |
| 安全扫描 | 仅 OWASP Top-10 正则+轻量语义 | 规则引擎+Haiku | <1s |

---

## 🚫 三、高风险检查项（CLI 场景下致命）

| 风险点 | 原 PRD 假设 | 本地 CLI 现实 | 级别 |
| --- | --- | --- | --- |
| **模型尺寸** | 默认 Opus 200B | 本地显存<8G；笔记本 CPU 常驻不可接受 | 🔴 阻塞 |
| **首次冷启** | 忽略 | 模型加载>5s 将打断 commit 流程 | 🔴 阻塞 |
| **离线可用** | 未提及 | 必须 100% 离线；任何云调用=不可用 | 🔴 阻塞 |
| **误报率** | ≤5% | 个人无 QA 团队，误报>2% 就会卸载 | 🟠 严重 |
| **副作用** | 自动修复 | 本地强制写文件可能破坏未提交代码 | 🔴 阻塞 |

---

## 📉 四、指标重定（个人场景）

| 类别 | 原指标 | 本地 CLI 指标 | 验收方法 |
| --- | --- | --- | --- |
| 性能 | P95<500ms | **冷启<3s；热调用<800ms** | `hyperfine` 十次平均 |
| 准确率 | 95% | **误报率≤2%** | 50 个开源 repo 人工标记 |
| 可用性 | 99.9% | **离线可用率 100%** | 断网测试 |
| 体积 | 未限制 | **安装包<100MB；模型<2GB** | `du -sh` |

---

## 🛠 五、技术方案强制修正

1. **模型降级路径**  
   - 默认：Claude-3-Haiku（API 调用需 `-offline=false` 显式开启）  
   - 离线：StarCoder-1B 4-bit 量化 + 规则引擎兜底  
   - 提供 `--model` 参数让用户自选，**绝不强制大模型**

2. **交互范式**  
   - 仅 `ccheck` 单命令，子命令不超过 4 个：  
     - `ccheck init` # 生成 `.git/hooks/pre-commit`  
     - `ccheck run` # 手动触发分析  
     - `ccheck config` # 终端问卷式配置  
   - 彩色输出遵守 `NO_COLOR` 环境变量  
   - 所有提示必须给 **“一次性关闭”** 选项（写入 `.ccheckignore`）

3. **副作用零容忍**  
   - 默认 `--dry-run` 预览；**必须显式 `-y` 才修改磁盘**  
   - 任何修改前先 `git stash push -m ccheck-autofix-backup`  
   - 提供 `ccheck rollback` 一键回滚最近一次 stash

---

## 🧪 六、MVP 裁切清单（否则不能开工）

| 功能 | 本次 MVP | 后续迭代 | 永不考虑 |
| --- | --- | --- | --- |
| 多语言 | 仅 Python/JS | Rust/Go | Java/C# |
| 文档生成 | 仅函数头注释 | 模块级 README | 完整静态站点 |
| 安全扫描 | 仅 Top-3 注入 | 完整 Top-10 | SAST 深度 |
| 配置 UI | TOML + 命令行 | TUI（可选插件） | Web 任何形式 |
| 并行加速 | 单线程 | 线程池 | 分布式 |

---

## 🧟 七、原 PRD 章节处置清单

| 原章节 | 处置方式 | 备注 |
| --- | --- | --- |
| 商业模式/ROI | **整章删除** | 本地免费工具，无收入 |
| 市场机会/规模 | **整章删除** | 个人工具，不面向市场 |
| 定价表 | **整章删除** | 0 价格 |
| 企业集成 | **整章删除** | 无 SSO、无 LDAP、无 SLA |
| Web 管理界面 | **整章删除** | 纯 CLI |
| 多用户协作 | **整章删除** | 单仓库单用户 |
| CI/CD 对接 | **整章删除** | 本地 hook 不碰远端 |

---

## ⚖️ 八、最终裁决

| 维度 | 原 PRD 得分 | 本地 CLI 修正后 | 是否放行 |
| --- | --- | --- | --- |
| 技术可行性 | 3/10 | 7/10 | ✅ 放行但需原型验证 |
| 场景匹配度 | 2/10 | 9/10 | ✅ 放行 |
| 资源现实性 | 2/10 | 8/10 | ✅ 放行 |
| 维护成本 | 1/10 | 6/10 | ⚠️ 严控功能蔓延 |

> **结论**：**允许启动 MVP**，但必须在 **4 周内** 交付离线可运行的 CLI 原型，并通过以下 **Exit Criteria**：
> 1. 断网环境 `pre-commit` 总耗时 <3s（冷启含模型加载）  
> 2. 误报率 ≤2%（50 个开源 repo 人工盲测）  
> 3. 安装脚本 `curl ... | sh` 一键完成，包体积 <100MB  
> 4. 任何自动修改均可 `ccheck rollback` 一键恢复  

**若未达成，项目立即冻结，回炉重写。**